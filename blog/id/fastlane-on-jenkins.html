<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Codeage - Fastlane di Jenkins dan Permasalahannya</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml" />

    <link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/syntax-highlights.css" rel="stylesheet" type="text/css" />
  </head>
  <body>


    <div id="main" role="main">
      


<nav>
  <h1 class="blog-title"><a href="/">Codeage</a></h1>
  <p class="blog-description">
    Pardon my ramblings about code and such
  </p>
  <div class="blog-lang">
    <a href="/blog/en/fastlane-on-jenkins.html">English</a> / <strong>Bahasa</strong>
  </div>
</nav>

      <article>
        <h1>Fastlane di Jenkins dan Permasalahannya</h1>
        <p><strong>Fastlane</strong> akan membantu kita dalam mengkonfigurasi jalur <em>deployment</em> yang kita punya. Ada beberapa keuntungan dalam menggunakan fastlane, apapun Continuous Integration (CI) yang kita gunakan, mau itu Travis di <em>cloud</em>, Jenkins di mesin CI lokal atau bahkan mesin yang kita gunakan untuk pengembangan.  <a href="https://fastlane.tools">Fastlane</a> terdiri dari berbagai kakas untuk berbagai kepentingan pula. Tempat pertama yang perlu kita cek adalah <a href="https://github.com/KrauseFx/fastlane/blob/master/docs/Actions.md">daftar perintah-perintah</a> yang bisa digunakan.</p>

<p>Memulai cukup cepat dan mudah. Fastlane bahkan punya asisten yang akan membantu kita <em>nyetting</em> di awal.</p>
<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="gp">$ </span><span class="o">(</span>sudo<span class="o">)</span> gem install fastlane
<span class="gp">$ </span><span class="nb">cd</span> &lt;folder dasar project&gt;
<span class="gp">$ </span>fastlane init
</pre></td></tr></tbody></table>
</div>

<p>Dan kita sudah siap! ðŸ‘Œ</p>

<h2>Keuntungan dibanding Jenkins Biasa</h2>

<h3>Bisa Digunakan di manapun</h3>

<p>Fastlane dapat dijalankan di semua mesin yang terinstall ruby dan gem yang bersangkutan. Permulaan saya menggunakan Fastlane adalah saat kami di tempat kerja sedang pindah kantor, sehingga tidak punya akses ke server Jenkins. Namun, klien tetap ingin selalu terupdate dengan build terbaru. Dengan menggunakan Fastlane beserta file konfigurasinya, semua developer bisa membuat build yang sama tanpa perlu akses ke Jenkins.</p>

<h3>Konfigurasi Tersimpan dalam Repositori</h3>

<p>File konfigurasi (yang bernama <code>Fastfile</code>) hanya berupa file teks biasa, jadi kita bisa dengan mudah menyimpannya dalam repositori. Kita bahkan tidak perlu lancar berbahasa Ruby karena sintaksnya yang mirip dengan bahasa Inggris biasa.</p>

<h3>Integrasi dengan Jenkins (yang Seharusnya Mudah)</h3>

<p><a href="https://twitter.com/ashfurrow">Ash Furrow</a> menulis <a href="https://github.com/KrauseFx/fastlane/blob/master/docs/Jenkins.md">panduan singkat</a> dalam mengintegrasikan Fastlane ke dalam Jenkins. Kalau Jenkins dan Fastlane sudah terinstall, kita tinggal membuat job baru yang punya dua pekerjaan, mengambil kode sumber dari repositori (dengan plugin git atau SVN) dan mengeksekusi skrip perintah Fastlane (<code>fastlane &lt;nama jalur&gt;</code>).</p>

<h2>Problem with Jenkins</h2>

<p>Integrasi dengan Jenkins semestinya mudah, namun saya menemukan beberapa masalah berdasarkan pengalaman saya.</p>

<h3>Jenkins Menggunakan Ruby dengan Versi yang Berbeda</h3>

<p>Pertama kali menjalankan <em>job</em> di Jenkins, ia komplen karena tidak bisa mendeteksi perintah <code>Fastlane</code>. Setelah dicek kembali dengan ssh, tampaknya semua telah terinstall dan baik-baik saja. Ternyata <a href="http://stackoverflow.com/a/10519349/851515">solusinya cukup mudah</a>, tinggal menggunakan <em>flag</em> <code>-l</code> agar menggunakan shell yang sama saat login.</p>

<p><strong>&lsquo;Execute shell&rsquo; di Jenkins</strong></p>
<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="c">#!/bin/bash -l</span>

<span class="c"># Saya sudah mengkofigurasi jalur bernama 'build' di `Fastfile`</span>
fastlane build
</pre></td></tr></tbody></table>
</div>

<h3>Keychain yang Terkunci</h3>

<p>Saya pernah mendapatkan error terkait code signing, yang menyebutkan bahwa keychain tidak bisa diakses karena terkunci. Solusi untuk masalah ini adalah menggunakan kakas <code>unlock-keychain</code> dengan password admin Anda.</p>

<p><strong>Execute shell</strong></p>
<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>security -v unlock-keychain -p <span class="s2">"&lt;password admin&gt;"</span> <span class="s2">"/Users/&lt;username&gt;/Library/Keychains/login.keychain"</span>
fastlane build
</pre></td></tr></tbody></table>
</div>

<h3>Error pada Codesigning</h3>

<p>Ini sebenarnya bukan masalah spesifik untuk Jenkins, tapi kalau Anda bertemu masalah dengan pesan error seperti <a href="http://stackoverflow.com/a/26499526/851515">ini</a>: &ldquo;<code>/tmp/QYFSJIvu7W/Payload/XX.app/ResourceRules.plist: cannot read resources</code>&rdquo;, maka kita perlu menambahkan file <code>&quot;ResourceRules.plist&quot;</code> ke dalam konfigurasi proyek di Xcode.</p>

<ul>
<li>Klik target dari proyek Xcode &gt; Build Settings &gt; Code Signing Resource Rules Path</li>
<li>Tambahkan <code>$(SDKROOT)/ResourceRules.plist</code></li>
</ul>

<h3>Error pada Codesigning (Lagi)</h3>

<p>Saya menemukan masalah ini saat menggunakan dua parameter dari perintah <a href="https://github.com/KrauseFx/fastlane/blob/master/docs/Actions.md#ipa">ipa</a> : <code>&#39;embed&#39;</code> and <code>&#39;identity&#39;</code>. Perintah ini menggunakan kakas <code>codesign</code> didalamnya. Tapi saya menemukan pesan error yang berujar <code>&quot;code failed to satisfy specified code requirement(s)&quot;</code>. Sedikit googling, saya langsung menemukan sebuah <a href="http://blog.hoachuck.biz/blog/2013/10/29/codesign-useful-info-in-xcode-5-dot-0-1/">artikel</a> yang menerangkan bahwa saya mempunyai path <code>codesign_allocate</code> yang salah.</p>

<p>Solusi dari permasalahan ini adalah dengan menambahkan <code>path</code> tersebut secara &ldquo;paksa&rdquo;. Kita bisa melakukannya di skrip dalam Jenkins (opsi execute shell) atau menambahkannya di Fastfile kita. Kalau saya tinggal menambahkannya saja di Fastfile;</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="n">platform</span> <span class="ss">:ios</span> <span class="k">do</span>
  <span class="n">desc</span> <span class="s2">"Making a build"</span>
  <span class="n">lane</span> <span class="ss">:build</span> <span class="k">do</span>

    <span class="c1"># Pengkoreksian path untuk kakas codesign_allocate</span>
    <span class="no">ENV</span><span class="p">[</span><span class="s1">'CODESIGN_ALLOCATE'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/codesign_allocate"</span>

    <span class="n">ipa</span><span class="p">(</span>
      <span class="ss">configuration: </span><span class="s2">"Debug"</span><span class="p">,</span>
      <span class="ss">scheme: </span><span class="s1">'MyApp'</span><span class="p">,</span> <span class="c1"># skema aplikasi</span>
      <span class="ss">destination: </span><span class="s2">"build"</span><span class="p">,</span> <span class="c1"># direktori tujuan</span>
      <span class="ss">embed: </span><span class="s1">'fastlane/my_distribution_cert.mobileprovision'</span><span class="p">,</span>
      <span class="ss">identity: </span><span class="s1">'iPhone Distribution: Ikhsan Assaat'</span><span class="p">,</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

        <div class="metadata">
          <div class="date">Jun. 9 2015</div>
          <div class="tag-list">
    <a class="tag" href="/blog/tags/ruby.html">ruby</a>
    <a class="tag" href="/blog/tags/fastlane.html">fastlane</a>
    <a class="tag" href="/blog/tags/jenkins.html">jenkins</a>
</div>

        </div>
      </article>

      
<div class="article-links">
  <div class="previous-link">
    <a href="/blog/id/extending-slather.html">&larr; Menambahkan Fitur Slather</a>
  </div>

  <div class="next-link">
    <a href="/blog/id/porting-mini-project-objc-to-swift.html">Kesan Pertama Mengubah Kode dari Objective-C ke Swift &rarr;</a>
  </div>

</div>

      <footer>
  <div class="footer-blog">
    <p>
      Saya Ikhsan dan ini adalah blog saya tentang pemikiran seputar koding. Hal-hal selain kodingan saya tulis di blog utama, <a href="http://ikhsan.me">Lifeage</a>. Kontak saya via Twitter <a href="http://twitter.com/ixnixnixn">@ixnixnixn</a> atau langsung saja email di <a href="mailto:ikhsan.assaat@gmail.com">ikhsan.assaat@gmail.com</a>.
    </p>
  </div>

  <div class="footer-links">
  <ul>
    <li><a href="http://twitter.com/ixnixnixn">Twitter</a></li>
    <li><a href="http://github.com/ikhsan">Github</a></li>
    <li><a href="http://ikhsan.me">Lifeage</a></li>
  </ul>

  <div class="copyright">
    <p>&copy; Codage 2009â€“2015</p>
  </div>
</div>


</footer>

    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-12712252-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
