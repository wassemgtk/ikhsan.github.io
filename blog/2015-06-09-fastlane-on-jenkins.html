<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Codeage</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml" />

    <link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
  </head>
  <body>

    <div id="main" role="main">
      


<nav>
  <h1 class="blog-title"><a href="/">Codeage</a></h1>
  <p class="blog-description">
    Pardon my ramblings about code and such
  </p>
  <div class="blog-lang">
    <strong>English</strong> / <a href="/id">Bahasa</a>
  </div>
</nav>

      <p><strong>Fastlane</strong> helps you configure your deployment pipeline. There are advantages by using fastlane whichever CI solution you have, whether it&rsquo;s Travis in the cloud, Jenkins in your local CI machine or even your own dev machine. READMORE <a href="https://fastlane.tools">Fastlane</a> comprises different toolsets for different purposes. First thing you might want to look at is its <a href="https://github.com/KrauseFx/fastlane/blob/master/docs/Actions.md">list of actions</a>.</p>

<p>Starting is quick and easy. Fastlane even has its own setup assistant to help you out.</p>
<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="gp">$ </span><span class="o">(</span>sudo<span class="o">)</span> gem install fastlane
<span class="gp">$ </span><span class="nb">cd</span> &lt;your project root folder&gt;
<span class="gp">$ </span>fastlane init
</pre></td></tr></tbody></table>
</div>

<p>And you are good to go! ðŸ‘Œ</p>

<h2>Advantages Compared to Normal Jenkins Job</h2>

<h3>Ubiquity</h3>

<p>Fastlane runs in any machine that has ruby and Fastlane gem installed. We had a problem accessing our Jenkins server for days because we are moving out. In the other hand, clients still need their builds ready.  By having Fastlane and its config file in each developer&rsquo;s machine, everyone could still make the same build without access to our Jenkins server.</p>

<h3>Config inside Repository</h3>

<p>The config files (known as <code>Fastfile</code>) are just plain texts, so we could just easily include it inside our repository. You don&rsquo;t even need to be proficient in ruby because the syntax is pretty close to plain english.</p>

<h3>Jenkins integration is (or should be) Easy</h3>

<p><a href="https://twitter.com/ashfurrow">Ash Furrow</a> wrote a <a href="https://github.com/KrauseFx/fastlane/blob/master/docs/Jenkins.md">short and sweet guideline</a> on integrating Fastlane to Jenkins. Once Jenkins and Fastlane is installed in your CI machine, you need to create a job that has two things: fetching the repository (using git or SVN plugin) and execute the Fastlane&rsquo;s script (<code>fastlane &lt;your lane&gt;</code>).</p>

<h2>Problem with Jenkins</h2>

<p>Integrating with Jenkins supposed to be effortless, but in my experience I met few problems along the way.</p>

<h3>Jenkins is Using Different Ruby</h3>

<p>First time I run the job, Jenkins complained that it cannot detect the <code>fastlane</code> command. I double checked via ssh and everything are installed. My <a href="http://stackoverflow.com/a/10519349/851515">workaround was simple</a>, I specify the <code>-l</code> flag to use the login shell.</p>

<p><strong>&lsquo;Execute shell&rsquo; in Jenkins</strong></p>
<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="c">#!/bin/bash -l</span>

<span class="c"># I have a 'build' lane configured in `Fastfile`</span>
fastlane build
</pre></td></tr></tbody></table>
</div>

<h3>Locked Keychain</h3>

<p>I had a Code Signing error that which says the login keychain is locked. To resolve this use <code>unlock-keychain</code> with your admin password.</p>

<p><strong>Execute shell</strong></p>
<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>security -v unlock-keychain -p <span class="s2">"&lt;your password&gt;"</span> <span class="s2">"/Users/&lt;username&gt;/Library/Keychains/login.keychain"</span>
fastlane build
</pre></td></tr></tbody></table>
</div>

<h3>Codesigning Error</h3>

<p>This is not necessarily a Jenkins-specific problem, but if you come across this problem like <a href="http://stackoverflow.com/a/26499526/851515">this</a>: &ldquo;<code>/tmp/QYFSJIvu7W/Payload/XX.app/ResourceRules.plist: cannot read resources</code>&rdquo;, then you need to add the <code>&quot;ResourceRules.plist&quot;</code> to your project.</p>

<ul>
<li>Click on your project&rsquo;s target &gt; Build Settings &gt; Code Signing Resource Rules Path</li>
<li>add <code>$(SDKROOT)/ResourceRules.plist</code></li>
</ul>

<h3>(Another) Codesigning Error</h3>

<p>I stumbled upon this issue when I&rsquo;m using these two <a href="https://github.com/KrauseFx/fastlane/blob/master/docs/Actions.md#ipa">ipa actions</a> paramaters: <code>&#39;embed&#39;</code> and <code>&#39;identity&#39;</code>. It uses <code>codesign</code> tools in the background. But I had an error saying that <code>&quot;code failed to satisfy specified code requirement(s)&quot;</code>. After quick search on the internet, I found <a href="http://blog.hoachuck.biz/blog/2013/10/29/codesign-useful-info-in-xcode-5-dot-0-1/">an article</a> that explains that I&rsquo;m having an incorrect codesign_allocate&rsquo;s path.</p>

<p>The workaround it to force adding it to the job. You can do that either inside the jenkins script or put it inside the Fastfile. My approach is to add it in my Fastfile;</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="n">platform</span> <span class="ss">:ios</span> <span class="k">do</span>
  <span class="n">desc</span> <span class="s2">"Making a build"</span> <span class="c1"># name of the lane</span>
  <span class="n">lane</span> <span class="ss">:build</span> <span class="k">do</span>

    <span class="c1"># force change environment variables for codesign_allocate tool</span>
    <span class="no">ENV</span><span class="p">[</span><span class="s1">'CODESIGN_ALLOCATE'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/codesign_allocate"</span>

    <span class="n">ipa</span><span class="p">(</span>
      <span class="ss">configuration: </span><span class="s2">"Debug"</span><span class="p">,</span>
      <span class="ss">scheme: </span><span class="s1">'MyApp'</span><span class="p">,</span> <span class="c1"># your scheme</span>
      <span class="ss">destination: </span><span class="s2">"build"</span><span class="p">,</span> <span class="c1"># your destination directory</span>
      <span class="ss">embed: </span><span class="s1">'fastlane/my_distribution_cert.mobileprovision'</span><span class="p">,</span> <span class="c1"># your distribution profile name</span>
      <span class="ss">identity: </span><span class="s1">'iPhone Distribution: Ikhsan Assaat'</span><span class="p">,</span> <span class="c1"># your identity</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

      <footer>
  <div class="footer-blog">
    <p>
      I'm Ikhsan and this is my blog for my thoughts on codes and the likes. All other stuff are on my main blog, <a href="http://ikhsan.me">Lifeage</a>. Get in touch via Twitter <a href="http://twitter.com/ixnixnixn">@ixnixnixn</a> or email <a href="mailto:ikhsan.assaat@gmail.com">ikhsan.assaat@gmail.com</a>.
    </p>
  </div>

  <div class="footer-links">
  <ul>
    <li><a href="http://twitter.com/ixnixnixn">Twitter</a></li>
    <li><a href="http://github.com/ikhsan">Github</a></li>
    <li><a href="http://ikhsan.me">Lifeage</a></li>
  </ul>

  <div class="copyright">
    <p>&copy; Codage 2009â€“2015</p>
  </div>
</div>


</footer>

    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-12712252-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
